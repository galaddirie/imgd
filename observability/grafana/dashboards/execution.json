{
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": { "type": "grafana", "uid": "-- Grafana --" },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": null,
    "links": [
      {
        "asDropdown": false,
        "icon": "dashboard",
        "includeVars": false,
        "keepTime": true,
        "tags": ["imgd"],
        "targetBlank": true,
        "title": "imgd Dashboards",
        "tooltip": "",
        "type": "dashboards",
        "url": ""
      }
    ],
    "liveNow": false,
    "panels": [
      {
        "collapsed": false,
        "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
        "id": 1,
        "panels": [],
        "title": "Execution Details",
        "type": "row"
      },
      {
        "datasource": { "type": "loki", "uid": "loki" },
        "description": "All logs for the selected execution, with trace links",
        "gridPos": { "h": 12, "w": 24, "x": 0, "y": 1 },
        "id": 2,
        "options": {
          "dedupStrategy": "none",
          "enableLogDetails": true,
          "prettifyLogMessage": true,
          "showCommonLabels": false,
          "showLabels": true,
          "showTime": true,
          "sortOrder": "Descending",
          "wrapLogMessage": false
        },
        "targets": [
          {
            "datasource": { "type": "loki", "uid": "loki" },
            "editorMode": "code",
            "expr": "{job=\"imgd\"} | json | execution_id = `$execution_id` | line_format \"[{{.level}}] {{.event}} - {{.message}} (step={{.step_name}})\"",
            "legendFormat": "",
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Execution Logs",
        "type": "logs"
      },
      {
        "collapsed": false,
        "gridPos": { "h": 1, "w": 24, "x": 0, "y": 13 },
        "id": 10,
        "panels": [],
        "title": "Traces",
        "type": "row"
      },
      {
        "datasource": { "type": "tempo", "uid": "tempo" },
        "description": "Traces for the selected execution",
        "gridPos": { "h": 12, "w": 24, "x": 0, "y": 14 },
        "id": 11,
        "options": {},
        "targets": [
          {
            "datasource": { "type": "tempo", "uid": "tempo" },
            "limit": 20,
            "query": "{ resource.service.name = \"imgd\" && span.execution.id = \"$execution_id\" }",
            "queryType": "traceqlSearch",
            "refId": "A",
            "tableType": "traces"
          }
        ],
        "title": "Execution Traces",
        "type": "traces"
      },
      {
        "collapsed": false,
        "gridPos": { "h": 1, "w": 24, "x": 0, "y": 26 },
        "id": 20,
        "panels": [],
        "title": "Step Analysis",
        "type": "row"
      },
      {
        "datasource": { "type": "loki", "uid": "loki" },
        "description": "Step execution timeline for this execution",
        "fieldConfig": {
          "defaults": {
            "color": { "mode": "palette-classic" },
            "custom": {
              "align": "auto",
              "cellOptions": { "type": "auto" },
              "inspect": false
            },
            "mappings": [],
            "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
          },
          "overrides": [
            {
              "matcher": { "id": "byName", "options": "duration_ms" },
              "properties": [
                { "id": "custom.cellOptions", "value": { "type": "color-background" } },
                {
                  "id": "thresholds",
                  "value": {
                    "mode": "absolute",
                    "steps": [
                      { "color": "green", "value": null },
                      { "color": "yellow", "value": 100 },
                      { "color": "red", "value": 1000 }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": { "h": 10, "w": 24, "x": 0, "y": 27 },
        "id": 21,
        "options": {
          "cellHeight": "sm",
          "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
          "showHeader": true,
          "sortBy": [{ "desc": false, "displayName": "Time" }]
        },
        "pluginVersion": "11.0.0",
        "targets": [
          {
            "datasource": { "type": "loki", "uid": "loki" },
            "editorMode": "code",
            "expr": "{job=\"imgd\"} | json | execution_id = `$execution_id` | event =~ \"step.*\" | line_format \"{{.step_name}}\"",
            "legendFormat": "",
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Step Execution Timeline",
        "transformations": [
          {
            "id": "extractFields",
            "options": {
              "source": "labels"
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": { "id": true, "tsNs": true },
              "indexByName": {},
              "renameByName": {}
            }
          }
        ],
        "type": "table"
      }
    ],
    "refresh": "",
    "schemaVersion": 39,
    "tags": ["imgd", "workflow", "investigation"],
    "templating": {
      "list": [
        {
          "current": { "selected": false, "text": "", "value": "" },
          "description": "Execution ID to investigate",
          "hide": 0,
          "label": "Execution ID",
          "name": "execution_id",
          "options": [],
          "query": "",
          "skipUrlSync": false,
          "type": "textbox"
        },
        {
          "current": { "selected": false, "text": "", "value": "" },
          "description": "Trace ID for correlation",
          "hide": 0,
          "label": "Trace ID",
          "name": "trace_id",
          "options": [],
          "query": "",
          "skipUrlSync": false,
          "type": "textbox"
        }
      ]
    },
    "time": { "from": "now-6h", "to": "now" },
    "timepicker": {},
    "timezone": "",
    "title": "imgd - Execution Investigation",
    "uid": "imgd-execution-investigation",
    "version": 1,
    "weekStart": ""
  }
